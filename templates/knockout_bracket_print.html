<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Cup Results - {{ user.username }}</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="/static/css/knockout_print.css">
    <style>
        @page {
            size: landscape;
            margin: 0.5cm;
        }
    </style>
</head>
<body class="print-view">
    <div class="print-container">
        <!-- Header Section -->
        <div class="print-header">
            <div class="print-title">
                <h1>FIFA World Cup Results</h1>
                <p class="print-username">{{ user.username }}</p>
            </div>

            {% if champion %}
            <div class="print-champion">
                <div class="champion-content">
                    <span class="trophy-icon">üèÜ</span>
                    {% if champion_flag_url %}
                    <img class="print-champion-flag" src="{{ champion_flag_url }}" alt="{{ champion.name }}" loading="eager" crossorigin="anonymous">
                    {% endif %}
                    <span class="champion-text">
                        <strong>{{ champion.name }}</strong>
                        <small>{{ 'Champion' if is_actual_champion else 'Predicted Winner' }}</small>
                    </span>
                </div>
            </div>
            {% endif %}

            <div class="print-score">
                <span class="score-label">Total Score</span>
                <span class="score-number">{{ total_score }}</span>
            </div>
        </div>

        <!-- Page 1: Group Stage Standings -->
        <div class="print-page-1">
            <div class="page-1-header">
                <h2>Group Stage Standings</h2>
                <p class="page-1-subtitle">{{ user.username }}'s Predictions</p>
            </div>

            {% if standings %}
            <div class="standings-grid-print">
                {% for group_letter in ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'] %}
                    {% if group_letter in standings %}
                    <div class="group-standings-print">
                        <h4 class="group-title-print">Group {{ group_letter }}</h4>
                        <table class="standings-table-print">
                            <thead>
                                <tr>
                                    <th>Pos</th>
                                    <th>Team</th>
                                    <th>P</th>
                                    <th>W</th>
                                    <th>D</th>
                                    <th>L</th>
                                    <th>GF</th>
                                    <th>GA</th>
                                    <th>GD</th>
                                    <th>Pts</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for team_standing in standings[group_letter] %}
                                <tr class="{% if loop.index <= 2 %}qualified-row{% endif %}">
                                    <td class="pos-cell">{{ loop.index }}</td>
                                    <td class="team-cell-print">
                                        {% if team_standing.team_flag_url %}
                                        <img src="{{ team_standing.team_flag_url }}" alt="{{ team_standing.team.code }}" class="team-flag-print" loading="eager" crossorigin="anonymous">
                                        {% endif %}
                                        <span class="team-code-print">{{ team_standing.team.code }}</span>
                                    </td>
                                    <td>{{ team_standing.played }}</td>
                                    <td class="stat-win">{{ team_standing.won }}</td>
                                    <td class="stat-draw">{{ team_standing.drawn }}</td>
                                    <td class="stat-loss">{{ team_standing.lost }}</td>
                                    <td>{{ team_standing.goals_for }}</td>
                                    <td>{{ team_standing.goals_against }}</td>
                                    <td class="{% if team_standing.goal_difference >= 0 %}positive-gd{% else %}negative-gd{% endif %}">
                                        {{ '+' if team_standing.goal_difference > 0 else '' }}{{ team_standing.goal_difference }}
                                    </td>
                                    <td class="points-cell"><strong>{{ team_standing.points }}</strong></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
            {% endif %}
        </div>

        <!-- Page Break -->
        <div class="page-break"></div>

        <!-- Page 2: Knockout Bracket -->
        <div class="print-bracket">
            {% set round_of_16 = [] %}
            {% set quarter_finals = [] %}
            {% set semi_finals = [] %}
            {% set knockout = namespace(third_place=None, final=None) %}

            {% for item in matches %}
                {% if item.match.round == "Round of 16" %}
                    {% set _ = round_of_16.append(item) %}
                {% elif item.match.round == "Quarter Finals" %}
                    {% set _ = quarter_finals.append(item) %}
                {% elif item.match.round == "Semi Finals" %}
                    {% set _ = semi_finals.append(item) %}
                {% elif item.match.round == "Third Place" %}
                    {% set knockout.third_place = item %}
                {% elif item.match.round == "Final" %}
                    {% set knockout.final = item %}
                {% endif %}
            {% endfor %}

            <!-- Round of 16 -->
            <div class="bracket-column r16">
                <h4>Round of 16</h4>
                {% for item in round_of_16 %}
                <div class="print-match">
                    <div class="print-team {% if (item.match.is_finished and item.match.actual_team1_score > item.match.actual_team2_score) or (item.match.is_finished and item.match.actual_team1_score == item.match.actual_team2_score and item.team1 and item.match.penalty_winner_id == item.team1.id) or (not item.match.is_finished and item.prediction and item.prediction.predicted_team1_score > item.prediction.predicted_team2_score) or (not item.match.is_finished and item.prediction and item.prediction.predicted_team1_score == item.prediction.predicted_team2_score and item.team1 and item.prediction.penalty_shootout_winner_id == item.team1.id) %}winner{% endif %}">
                        {% if item.team1_flag_url %}
                        <img src="{{ item.team1_flag_url }}" alt="{{ item.team1.code if item.team1 else 'TBD' }}" loading="eager" crossorigin="anonymous">
                        {% endif %}
                        <span class="team-code">{{ item.team1.code if item.team1 else 'TBD' }}</span>
                        <span class="score">
                            {% if item.match.is_finished %}
                                {{ item.match.actual_team1_score }}
                                {% if item.match.actual_team1_penalty_score is not none %}
                                <small>({{ item.match.actual_team1_penalty_score }})</small>
                                {% endif %}
                            {% elif item.prediction %}
                                {{ item.prediction.predicted_team1_score }}
                            {% else %}
                                -
                            {% endif %}
                        </span>
                    </div>
                    <div class="print-team {% if (item.match.is_finished and item.match.actual_team2_score > item.match.actual_team1_score) or (item.match.is_finished and item.match.actual_team1_score == item.match.actual_team2_score and item.team2 and item.match.penalty_winner_id == item.team2.id) or (not item.match.is_finished and item.prediction and item.prediction.predicted_team2_score > item.prediction.predicted_team1_score) or (not item.match.is_finished and item.prediction and item.prediction.predicted_team2_score == item.prediction.predicted_team1_score and item.team2 and item.prediction.penalty_shootout_winner_id == item.team2.id) %}winner{% endif %}">
                        {% if item.team2_flag_url %}
                        <img src="{{ item.team2_flag_url }}" alt="{{ item.team2.code if item.team2 else 'TBD' }}" loading="eager" crossorigin="anonymous">
                        {% endif %}
                        <span class="team-code">{{ item.team2.code if item.team2 else 'TBD' }}</span>
                        <span class="score">
                            {% if item.match.is_finished %}
                                {{ item.match.actual_team2_score }}
                                {% if item.match.actual_team2_penalty_score is not none %}
                                <small>({{ item.match.actual_team2_penalty_score }})</small>
                                {% endif %}
                            {% elif item.prediction %}
                                {{ item.prediction.predicted_team2_score }}
                            {% else %}
                                -
                            {% endif %}
                        </span>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Quarter Finals -->
            <div class="bracket-column quarters">
                <h4>Quarter Finals</h4>
                {% for item in quarter_finals %}
                <div class="print-match">
                    <div class="print-team {% if (item.match.is_finished and item.match.actual_team1_score > item.match.actual_team2_score) or (item.match.is_finished and item.match.actual_team1_score == item.match.actual_team2_score and item.team1 and item.match.penalty_winner_id == item.team1.id) or (not item.match.is_finished and item.prediction and item.prediction.predicted_team1_score > item.prediction.predicted_team2_score) or (not item.match.is_finished and item.prediction and item.prediction.predicted_team1_score == item.prediction.predicted_team2_score and item.team1 and item.prediction.penalty_shootout_winner_id == item.team1.id) %}winner{% endif %}">
                        {% if item.team1_flag_url %}
                        <img src="{{ item.team1_flag_url }}" alt="{{ item.team1.code if item.team1 else 'TBD' }}" loading="eager" crossorigin="anonymous">
                        {% endif %}
                        <span class="team-code">{{ item.team1.code if item.team1 else 'TBD' }}</span>
                        <span class="score">
                            {% if item.match.is_finished %}
                                {{ item.match.actual_team1_score }}
                                {% if item.match.actual_team1_penalty_score is not none %}
                                <small>({{ item.match.actual_team1_penalty_score }})</small>
                                {% endif %}
                            {% elif item.prediction %}
                                {{ item.prediction.predicted_team1_score }}
                            {% else %}
                                -
                            {% endif %}
                        </span>
                    </div>
                    <div class="print-team {% if (item.match.is_finished and item.match.actual_team2_score > item.match.actual_team1_score) or (item.match.is_finished and item.match.actual_team1_score == item.match.actual_team2_score and item.team2 and item.match.penalty_winner_id == item.team2.id) or (not item.match.is_finished and item.prediction and item.prediction.predicted_team2_score > item.prediction.predicted_team1_score) or (not item.match.is_finished and item.prediction and item.prediction.predicted_team2_score == item.prediction.predicted_team1_score and item.team2 and item.prediction.penalty_shootout_winner_id == item.team2.id) %}winner{% endif %}">
                        {% if item.team2_flag_url %}
                        <img src="{{ item.team2_flag_url }}" alt="{{ item.team2.code if item.team2 else 'TBD' }}" loading="eager" crossorigin="anonymous">
                        {% endif %}
                        <span class="team-code">{{ item.team2.code if item.team2 else 'TBD' }}</span>
                        <span class="score">
                            {% if item.match.is_finished %}
                                {{ item.match.actual_team2_score }}
                                {% if item.match.actual_team2_penalty_score is not none %}
                                <small>({{ item.match.actual_team2_penalty_score }})</small>
                                {% endif %}
                            {% elif item.prediction %}
                                {{ item.prediction.predicted_team2_score }}
                            {% else %}
                                -
                            {% endif %}
                        </span>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Semi Finals -->
            <div class="bracket-column semis">
                <h4>Semi Finals</h4>
                {% for item in semi_finals %}
                <div class="print-match">
                    <div class="print-team {% if (item.match.is_finished and item.match.actual_team1_score > item.match.actual_team2_score) or (item.match.is_finished and item.match.actual_team1_score == item.match.actual_team2_score and item.team1 and item.match.penalty_winner_id == item.team1.id) or (not item.match.is_finished and item.prediction and item.prediction.predicted_team1_score > item.prediction.predicted_team2_score) or (not item.match.is_finished and item.prediction and item.prediction.predicted_team1_score == item.prediction.predicted_team2_score and item.team1 and item.prediction.penalty_shootout_winner_id == item.team1.id) %}winner{% endif %}">
                        {% if item.team1_flag_url %}
                        <img src="{{ item.team1_flag_url }}" alt="{{ item.team1.code if item.team1 else 'TBD' }}" loading="eager" crossorigin="anonymous">
                        {% endif %}
                        <span class="team-code">{{ item.team1.code if item.team1 else 'TBD' }}</span>
                        <span class="score">
                            {% if item.match.is_finished %}
                                {{ item.match.actual_team1_score }}
                                {% if item.match.actual_team1_penalty_score is not none %}
                                <small>({{ item.match.actual_team1_penalty_score }})</small>
                                {% endif %}
                            {% elif item.prediction %}
                                {{ item.prediction.predicted_team1_score }}
                            {% else %}
                                -
                            {% endif %}
                        </span>
                    </div>
                    <div class="print-team {% if (item.match.is_finished and item.match.actual_team2_score > item.match.actual_team1_score) or (item.match.is_finished and item.match.actual_team1_score == item.match.actual_team2_score and item.team2 and item.match.penalty_winner_id == item.team2.id) or (not item.match.is_finished and item.prediction and item.prediction.predicted_team2_score > item.prediction.predicted_team1_score) or (not item.match.is_finished and item.prediction and item.prediction.predicted_team2_score == item.prediction.predicted_team1_score and item.team2 and item.prediction.penalty_shootout_winner_id == item.team2.id) %}winner{% endif %}">
                        {% if item.team2_flag_url %}
                        <img src="{{ item.team2_flag_url }}" alt="{{ item.team2.code if item.team2 else 'TBD' }}" loading="eager" crossorigin="anonymous">
                        {% endif %}
                        <span class="team-code">{{ item.team2.code if item.team2 else 'TBD' }}</span>
                        <span class="score">
                            {% if item.match.is_finished %}
                                {{ item.match.actual_team2_score }}
                                {% if item.match.actual_team2_penalty_score is not none %}
                                <small>({{ item.match.actual_team2_penalty_score }})</small>
                                {% endif %}
                            {% elif item.prediction %}
                                {{ item.prediction.predicted_team2_score }}
                            {% else %}
                                -
                            {% endif %}
                        </span>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Finals Column -->
            <div class="bracket-column finals">
                <h4>Final</h4>
                {% if knockout.final %}
                <div class="print-match final">
                    <div class="print-team {% if (knockout.final.match.is_finished and knockout.final.match.actual_team1_score > knockout.final.match.actual_team2_score) or (knockout.final.match.is_finished and knockout.final.match.actual_team1_score == knockout.final.match.actual_team2_score and knockout.final.team1 and knockout.final.match.penalty_winner_id == knockout.final.team1.id) or (not knockout.final.match.is_finished and knockout.final.prediction and knockout.final.prediction.predicted_team1_score > knockout.final.prediction.predicted_team2_score) or (not knockout.final.match.is_finished and knockout.final.prediction and knockout.final.prediction.predicted_team1_score == knockout.final.prediction.predicted_team2_score and knockout.final.team1 and knockout.final.prediction.penalty_shootout_winner_id == knockout.final.team1.id) %}winner{% endif %}">
                        {% if knockout.final.team1_flag_url %}
                        <img src="{{ knockout.final.team1_flag_url }}" alt="{{ knockout.final.team1.code if knockout.final.team1 else 'TBD' }}" loading="eager" crossorigin="anonymous">
                        {% endif %}
                        <span class="team-code">{{ knockout.final.team1.code if knockout.final.team1 else 'TBD' }}</span>
                        <span class="score">
                            {% if knockout.final.match.is_finished %}
                                {{ knockout.final.match.actual_team1_score }}
                                {% if knockout.final.match.actual_team1_penalty_score is not none %}
                                <small>({{ knockout.final.match.actual_team1_penalty_score }})</small>
                                {% endif %}
                            {% elif knockout.final.prediction %}
                                {{ knockout.final.prediction.predicted_team1_score }}
                            {% else %}
                                -
                            {% endif %}
                        </span>
                    </div>
                    <div class="print-team {% if (knockout.final.match.is_finished and knockout.final.match.actual_team2_score > knockout.final.match.actual_team1_score) or (knockout.final.match.is_finished and knockout.final.match.actual_team1_score == knockout.final.match.actual_team2_score and knockout.final.team2 and knockout.final.match.penalty_winner_id == knockout.final.team2.id) or (not knockout.final.match.is_finished and knockout.final.prediction and knockout.final.prediction.predicted_team2_score > knockout.final.prediction.predicted_team1_score) or (not knockout.final.match.is_finished and knockout.final.prediction and knockout.final.prediction.predicted_team2_score == knockout.final.prediction.predicted_team1_score and knockout.final.team2 and knockout.final.prediction.penalty_shootout_winner_id == knockout.final.team2.id) %}winner{% endif %}">
                        {% if knockout.final.team2_flag_url %}
                        <img src="{{ knockout.final.team2_flag_url }}" alt="{{ knockout.final.team2.code if knockout.final.team2 else 'TBD' }}" loading="eager" crossorigin="anonymous">
                        {% endif %}
                        <span class="team-code">{{ knockout.final.team2.code if knockout.final.team2 else 'TBD' }}</span>
                        <span class="score">
                            {% if knockout.final.match.is_finished %}
                                {{ knockout.final.match.actual_team2_score }}
                                {% if knockout.final.match.actual_team2_penalty_score is not none %}
                                <small>({{ knockout.final.match.actual_team2_penalty_score }})</small>
                                {% endif %}
                            {% elif knockout.final.prediction %}
                                {{ knockout.final.prediction.predicted_team2_score }}
                            {% else %}
                                -
                            {% endif %}
                        </span>
                    </div>
                </div>
                {% endif %}

                <h4>3rd Place</h4>
                {% if knockout.third_place %}
                <div class="print-match third">
                    <div class="print-team {% if (knockout.third_place.match.is_finished and knockout.third_place.match.actual_team1_score > knockout.third_place.match.actual_team2_score) or (knockout.third_place.match.is_finished and knockout.third_place.match.actual_team1_score == knockout.third_place.match.actual_team2_score and knockout.third_place.team1 and knockout.third_place.match.penalty_winner_id == knockout.third_place.team1.id) or (not knockout.third_place.match.is_finished and knockout.third_place.prediction and knockout.third_place.prediction.predicted_team1_score > knockout.third_place.prediction.predicted_team2_score) or (not knockout.third_place.match.is_finished and knockout.third_place.prediction and knockout.third_place.prediction.predicted_team1_score == knockout.third_place.prediction.predicted_team2_score and knockout.third_place.team1 and knockout.third_place.prediction.penalty_shootout_winner_id == knockout.third_place.team1.id) %}winner{% endif %}">
                        {% if knockout.third_place.team1_flag_url %}
                        <img src="{{ knockout.third_place.team1_flag_url }}" alt="{{ knockout.third_place.team1.code if knockout.third_place.team1 else 'TBD' }}" loading="eager" crossorigin="anonymous">
                        {% endif %}
                        <span class="team-code">{{ knockout.third_place.team1.code if knockout.third_place.team1 else 'TBD' }}</span>
                        <span class="score">
                            {% if knockout.third_place.match.is_finished %}
                                {{ knockout.third_place.match.actual_team1_score }}
                                {% if knockout.third_place.match.actual_team1_penalty_score is not none %}
                                <small>({{ knockout.third_place.match.actual_team1_penalty_score }})</small>
                                {% endif %}
                            {% elif knockout.third_place.prediction %}
                                {{ knockout.third_place.prediction.predicted_team1_score }}
                            {% else %}
                                -
                            {% endif %}
                        </span>
                    </div>
                    <div class="print-team {% if (knockout.third_place.match.is_finished and knockout.third_place.match.actual_team2_score > knockout.third_place.match.actual_team1_score) or (knockout.third_place.match.is_finished and knockout.third_place.match.actual_team1_score == knockout.third_place.match.actual_team2_score and knockout.third_place.team2 and knockout.third_place.match.penalty_winner_id == knockout.third_place.team2.id) or (not knockout.third_place.match.is_finished and knockout.third_place.prediction and knockout.third_place.prediction.predicted_team2_score > knockout.third_place.prediction.predicted_team1_score) or (not knockout.third_place.match.is_finished and knockout.third_place.prediction and knockout.third_place.prediction.predicted_team2_score == knockout.third_place.prediction.predicted_team1_score and knockout.third_place.team2 and knockout.third_place.prediction.penalty_shootout_winner_id == knockout.third_place.team2.id) %}winner{% endif %}">
                        {% if knockout.third_place.team2_flag_url %}
                        <img src="{{ knockout.third_place.team2_flag_url }}" alt="{{ knockout.third_place.team2.code if knockout.third_place.team2 else 'TBD' }}" loading="eager" crossorigin="anonymous">
                        {% endif %}
                        <span class="team-code">{{ knockout.third_place.team2.code if knockout.third_place.team2 else 'TBD' }}</span>
                        <span class="score">
                            {% if knockout.third_place.match.is_finished %}
                                {{ knockout.third_place.match.actual_team2_score }}
                                {% if knockout.third_place.match.actual_team2_penalty_score is not none %}
                                <small>({{ knockout.third_place.match.actual_team2_penalty_score }})</small>
                                {% endif %}
                            {% elif knockout.third_place.prediction %}
                                {{ knockout.third_place.prediction.predicted_team2_score }}
                            {% else %}
                                -
                            {% endif %}
                        </span>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Print Actions (hidden when printing) -->
        <div class="print-actions no-print">
            <button onclick="window.print()" class="btn-print">Print / Save as PDF</button>
            <a href="/bracket/knockout" class="btn-back">Back to Results</a>
        </div>
    </div>

    <script>
        // Auto-trigger print dialog on load (optional)
        // window.onload = function() { window.print(); };
    </script>
</body>
</html>
