<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Bracket - FIFA World Cup 2026</title>
    <link href="/static/css/output.css" rel="stylesheet">
    <style>
        @media print {
            body { 
                -webkit-print-color-adjust: exact !important; 
                print-color-adjust: exact !important; 
                padding: 0 !important;
            }
            @page { margin: 0.5cm; }
            .page-break { page-break-before: always; }
            .no-print { display: none !important; }
        }
        
        .flag-icon {
            display: inline-block;
            width: 1.5em;
            height: 1em;
            background-size: cover;
            background-position: center;
            border: 1px solid #e2e8f0;
        }

        /* Compact Table Styles */
        .group-table th { background-color: #f1f5f9; font-size: 0.65rem; padding: 2px; }
        .group-table td { font-size: 0.7rem; padding: 2px; border-bottom: 1px solid #f1f5f9; }
        .group-header { background-color: #1e293b; color: white; padding: 2px 8px; font-weight: bold; font-size: 0.8rem; }
    </style>
</head>
<body class="bg-white text-slate-900 font-sans p-6 max-w-[210mm] mx-auto">

    <!-- Print Controls (Hidden on print) -->
    <div class="no-print fixed top-4 right-4 z-50 flex gap-2">
        <button onclick="window.print()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded shadow-lg flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>
            Print Now
        </button>
        <a href="/bracket" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded shadow-lg">Close</a>
    </div>

    <!-- PAGE 1 -->
    <div class="h-full relative">
        <!-- Header -->
        <div class="border-b-2 border-slate-800 pb-4 mb-6">
            <div class="flex justify-between items-end">
                <div>
                    <h1 class="text-3xl font-bold uppercase tracking-tight">FIFA World Cup 2026</h1>
                    <p class="text-slate-500 text-sm mt-1">Predictions by <span class="text-slate-900 font-bold text-lg">{{ current_user.display_name }}</span></p>
                </div>
                <div class="text-right text-xs text-slate-400">
                    Generated on {{ timestamp }}
                </div>
            </div>
        </div>

        <!-- Winners Section -->
        <div class="flex gap-8 mb-8 bg-slate-50 p-6 rounded-xl border border-slate-200">
            <!-- Champion -->
            <div class="flex-1 text-center border-r border-slate-200 pr-8">
                <div class="text-xs font-bold text-yellow-600 uppercase tracking-wider mb-2">World Cup Champion</div>
                {% if champion %}
                    <div class="flex flex-col items-center">
                        <img src="https://flagcdn.com/w160/{{ flag_code(champion.country_code) }}.png" class="h-16 w-auto shadow-sm rounded mb-2 border border-gray-200">
                        <div class="text-2xl font-black text-slate-900 leading-tight">{{ champion.team_name }}</div>
                    </div>
                {% else %}
                    <div class="text-gray-400 italic py-4">Not predicted yet</div>
                {% endif %}
            </div>

            <!-- Third Place -->
            <div class="flex-1 text-center">
                <div class="text-xs font-bold text-orange-600 uppercase tracking-wider mb-2">Third Place</div>
                {% if third_place_winner %}
                    <div class="flex flex-col items-center">
                        <img src="https://flagcdn.com/w80/{{ flag_code(third_place_winner.country_code) }}.png" class="h-12 w-auto shadow-sm rounded mb-2 border border-gray-200">
                        <div class="text-xl font-bold text-slate-800 leading-tight">{{ third_place_winner.team_name }}</div>
                    </div>
                {% else %}
                    <div class="text-gray-400 italic py-4">Not predicted yet</div>
                {% endif %}
            </div>
        </div>

        <!-- Groups Grid -->
        <h2 class="text-sm font-bold uppercase text-slate-500 mb-3 border-b border-slate-200 pb-1">Group Stage Results</h2>
        <div class="grid grid-cols-3 gap-x-4 gap-y-4">
            {% for group_letter, standings in bracket.groups.items() %}
            <div class="border border-slate-300 rounded overflow-hidden">
                <div class="group-header flex justify-between items-center">
                    <span>Group {{ group_letter }}</span>
                </div>
                <table class="w-full group-table">
                    <thead>
                        <tr>
                            <th class="text-left w-6">#</th>
                            <th class="text-left">Team</th>
                            <th class="text-center w-6">P</th>
                            <th class="text-center w-6">GD</th>
                            <th class="text-center w-6">Pts</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for team in standings %}
                        <tr class="{{ 'bg-green-50' if team.position <= 2 else ('bg-yellow-50' if team.position == 3 else '') }}">
                            <td class="font-semibold text-slate-500">{{ team.position }}</td>
                            <td class="font-bold">
                                <span class="inline-block w-3 h-2 mr-1 align-middle border border-gray-300" style="background-image: url('https://flagcdn.com/w40/{{ flag_code(team.country_code) }}.png'); background-size: cover;"></span>
                                {{ team.team_name|truncate(12, True) }}
                            </td>
                            <td class="text-center text-slate-500">{{ team.played }}</td>
                            <td class="text-center text-slate-500">{{ team.goal_diff }}</td>
                            <td class="text-center font-bold text-slate-900">{{ team.points }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="page-break"></div>

    <!-- PAGE 2 -->
    <div class="h-full relative pt-4">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold uppercase tracking-tight">Knockout Phase</h2>
            <div class="text-xs text-slate-400">Page 2/2</div>
        </div>

        <div class="grid grid-cols-3 gap-6 text-xs">
            <!-- Column 1: Round of 32 -->
            <div>
                <h3 class="font-bold text-slate-500 border-b border-slate-200 mb-3 pb-1">Round of 32</h3>
                <div class="space-y-2">
                    {% for match in bracket.round_of_32 %}
                        {% include 'bracket/partials/print_match_row.html' %}
                    {% endfor %}
                </div>
            </div>

            <!-- Column 2: Round of 16 & QF -->
            <div class="space-y-8">
                <div>
                    <h3 class="font-bold text-slate-500 border-b border-slate-200 mb-3 pb-1">Round of 16</h3>
                    <div class="space-y-3">
                        {% for match in bracket.round_of_16 %}
                            {% include 'bracket/partials/print_match_row.html' %}
                        {% endfor %}
                    </div>
                </div>
                
                <div>
                    <h3 class="font-bold text-slate-500 border-b border-slate-200 mb-3 pb-1">Quarter Finals</h3>
                    <div class="space-y-3">
                        {% for match in bracket.quarter_finals %}
                            {% include 'bracket/partials/print_match_row.html' %}
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Column 3: SF, Final, 3rd -->
            <div class="space-y-8">
                <div>
                    <h3 class="font-bold text-slate-500 border-b border-slate-200 mb-3 pb-1">Semi Finals</h3>
                    <div class="space-y-4">
                        {% for match in bracket.semi_finals %}
                            {% include 'bracket/partials/print_match_row.html' %}
                        {% endfor %}
                    </div>
                </div>

                <div class="bg-yellow-50 p-3 rounded border border-yellow-200">
                    <h3 class="font-bold text-yellow-700 border-b border-yellow-200 mb-3 pb-1">Final</h3>
                    <div>
                        {% set match = bracket.final %}
                        {% include 'bracket/partials/print_match_row.html' %}
                    </div>
                </div>

                <div class="bg-orange-50 p-3 rounded border border-orange-200">
                    <h3 class="font-bold text-orange-700 border-b border-orange-200 mb-3 pb-1">Third Place Match</h3>
                    <div>
                        {% set match = bracket.third_place_match %}
                        {% include 'bracket/partials/print_match_row.html' %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Print JS auto-trigger if requested via query param -->
    <script>
        window.onload = function() {
            // Optional: Auto print
            // window.print();
        }
    </script>
</body>
</html>
