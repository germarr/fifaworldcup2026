{% extends "base.html" %}
{% from "components/team_flag.html" import flag %}

{% block title %}Match Results - FIFA World Cup 2026{% endblock %}

{% block head %}
<style>
    .result-card {
        background: white;
        border-radius: 0.5rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        transition: box-shadow 0.2s;
    }
    .result-card:hover {
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .result-completed {
        border-left: 4px solid #22c55e;
    }
    .result-pending {
        border-left: 4px solid #d1d5db;
    }
    .round-nav {
        position: sticky;
        top: 0;
        z-index: 10;
        background: #f3f4f6;
        padding: 0.5rem 0;
    }
</style>
{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold mb-6">Match Results</h1>

    <p class="text-gray-600 mb-8">
        View official match results from the FIFA World Cup 2026.
    </p>

    {% if results_by_round %}
        <!-- Round Filter Navigation -->
        <div class="round-nav flex flex-wrap gap-2 mb-6">
            {% for round_key, round_label in round_order %}
                {% if round_key in results_by_round %}
                    <a href="#{{ round_key }}" class="btn-secondary text-sm py-1 px-3">
                        {{ round_label }}
                    </a>
                {% endif %}
            {% endfor %}
        </div>

        <!-- Results by Round -->
        {% for round_key, round_label in round_order %}
            {% if round_key in results_by_round %}
                <div id="{{ round_key }}" class="mb-10 scroll-mt-16">
                    <!-- Round Header -->
                    <h2 class="text-2xl font-bold mb-4 {% if round_key == 'group_stage' %}text-blue-600{% elif round_key == 'round_of_32' %}text-red-600{% elif round_key == 'round_of_16' %}text-orange-600{% elif round_key == 'quarter_final' %}text-yellow-600{% elif round_key == 'semi_final' %}text-purple-600{% elif round_key == 'third_place' %}text-amber-700{% elif round_key == 'final' %}text-fifa-gold{% endif %}">
                        {% if round_key == 'final' %}
                            <span class="mr-1">&#128081;</span>
                        {% elif round_key == 'third_place' %}
                            <span class="mr-1">&#129353;</span>
                        {% endif %}
                        {{ round_label }}
                        <span class="text-base font-normal text-gray-400 ml-2">({{ results_by_round[round_key]|length }} matches)</span>
                    </h2>

                    <!-- Match Results Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        {% for result in results_by_round[round_key] %}
                            <div class="result-card p-4 {% if result.is_completed %}result-completed{% else %}result-pending{% endif %}">
                                <!-- Match Header -->
                                <div class="flex items-center justify-between mb-3">
                                    <div class="text-xs text-gray-500">
                                        Match #{{ result.match_number }}
                                        {% if result.group_letter %}
                                            <span class="text-gray-400">| Group {{ result.group_letter }}</span>
                                        {% endif %}
                                    </div>
                                    {% if result.is_completed %}
                                        <span class="text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded">Final</span>
                                    {% else %}
                                        <span class="text-xs bg-gray-100 text-gray-500 px-2 py-0.5 rounded">Scheduled</span>
                                    {% endif %}
                                </div>

                                <div class="text-xs text-gray-500 mb-3">
                                    {% if result.scheduled_datetime %}
                                        <span>{{ result.scheduled_datetime.strftime('%b %d, %Y %H:%M') }}</span>
                                    {% endif %}
                                    {% if result.stadium %}
                                        <span class="ml-1">&#8226; {{ result.stadium.city }}</span>
                                    {% endif %}
                                </div>

                                <!-- Match Result -->
                                <div class="flex items-center justify-between">
                                    <!-- Home Team -->
                                    <div class="flex items-center gap-2 flex-1">
                                        {% if result.home_team %}
                                            {{ flag(result.home_team.country_code, 24) }}
                                            <span class="text-sm font-medium truncate">{{ result.home_team.name }}</span>
                                        {% else %}
                                            <span class="text-sm text-gray-400">TBD</span>
                                        {% endif %}
                                    </div>

                                    <!-- Score -->
                                    <div class="px-4 text-center">
                                        {% if result.is_completed %}
                                            <span class="text-2xl font-bold">{{ result.actual_home_score }} - {{ result.actual_away_score }}</span>
                                        {% else %}
                                            <span class="text-lg text-gray-400">vs</span>
                                        {% endif %}
                                    </div>

                                    <!-- Away Team -->
                                    <div class="flex items-center gap-2 flex-1 justify-end">
                                        {% if result.away_team %}
                                            <span class="text-sm font-medium truncate text-right">{{ result.away_team.name }}</span>
                                            {{ flag(result.away_team.country_code, 24) }}
                                        {% else %}
                                            <span class="text-sm text-gray-400">TBD</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        {% endfor %}

    {% else %}
        <!-- Empty State -->
        <div class="card text-center py-12">
            <div class="text-6xl mb-4">&#9917;</div>
            <p class="text-gray-500 mb-4">No match results available yet.</p>
            <a href="/bracket/groups" class="btn-primary">Start Predicting</a>
        </div>
    {% endif %}
</div>
{% endblock %}
